<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Orcheo ChatKit Embed Demo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script
      src="https://cdn.platform.openai.com/deployments/chatkit/chatkit.js"
      async
    ></script>
    <style>
      :root {
        color-scheme: light dark;
        font-family: system-ui, -apple-system, "Segoe UI", sans-serif;
      }

      body {
        margin: 0;
        padding: 2rem;
        min-height: 100vh;
        display: grid;
        place-items: center;
        background: radial-gradient(circle at top, #f4f7fb, #eef1f6);
      }

      .wrapper {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        width: min(560px, 100%);
      }

      .wrapper h1 {
        font-size: 1.75rem;
        margin: 0;
      }

      .wrapper p {
        margin: 0;
        line-height: 1.5;
      }

      openai-chatkit {
        width: 100%;
        height: 560px;
        border-radius: 16px;
        overflow: hidden;
        box-shadow: 0 16px 48px rgba(15, 35, 95, 0.18);
      }
    </style>
  </head>
  <body>
    <main class="wrapper">
      <div>
        <h1>Chat-triggered Workflow Demo</h1>
        <p>
          Update the constants in <code>examples/chatkit/embed.html</code> with your
          workflow information and serve this file locally (for example with
          <code>python -m http.server</code>). Messages sent below will be forwarded to the
          Orcheo backend through the new ChatKit endpoint.
        </p>
      </div>
      <openai-chatkit id="orcheo-chat"></openai-chatkit>
    </main>
    <script type="module">
      const WORKFLOW_ID = "replace-with-workflow-id";
      const NODE_ID = "replace-with-chat-trigger-node-id"; // optional
      const BACKEND_URL = "http://localhost:8000"; // adjust if the backend runs elsewhere

      if (!WORKFLOW_ID || WORKFLOW_ID.startsWith("replace")) {
        console.warn("Update WORKFLOW_ID in examples/chatkit/embed.html before testing.");
      }

      const chatkit = document.getElementById("orcheo-chat");
      if (!chatkit) {
        throw new Error("ChatKit element not found");
      }

      const apiBase = BACKEND_URL.replace(/\/$/, "");

      chatkit.setOptions({
        api: {
          url: `${apiBase}/api/chatkit`,
          fetch(url, options = {}) {
            const headers = new Headers(options.headers ?? {});
            headers.set("X-Orcheo-Workflow-Id", WORKFLOW_ID);
            if (NODE_ID && !NODE_ID.startsWith("replace")) {
              headers.set("X-Orcheo-Node-Id", NODE_ID);
            }
            headers.set("X-Orcheo-Chat-Actor", "embed-example");
            headers.set("X-Orcheo-Chat-Label", "Embedded Chat Demo");
            return fetch(url, { ...options, headers });
          },
        },
        header: {
          enabled: true,
          title: { text: "Orcheo Assistant" },
        },
        startScreen: {
          enabled: true,
          title: "Test your workflow",
          subtitle:
            "Send a message to dispatch the configured workflow through the ChatKit API.",
        },
        history: { enabled: true },
        theme: {
          colorScheme: "light",
          radius: "round",
        },
      });
    </script>
  </body>
</html>
